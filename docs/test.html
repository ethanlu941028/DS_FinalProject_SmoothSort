<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Smooth Sort 測試</title>
</head>
<body>
    <h1>Smooth Sort 演算法測試</h1>
    <div id="output"></div>
    
    <script>
        const LEONARDO = [1, 1, 3, 5, 9, 15, 25, 41, 67, 109, 177, 287, 465, 753, 1219, 1973, 3193, 5167, 8361, 13529, 21891, 35421, 57313, 92735, 150049, 242785, 392835, 635621, 1028457, 1664079, 2692537, 4356617, 7049155, 11405773, 18454929, 29860703, 48315633, 78176337, 126491971, 204668309, 331160281, 535828591, 866988873];
        
        const testArray = [7, 2, 8, 1, 4, 9];
        const output = document.getElementById('output');
        
        let html = '<h2>測試陣列: ' + testArray.join(', ') + '</h2>';
        html += '<h3>建構過程:</h3><ol>';
        
        const forest = [];
        
        for (let i = 0; i < testArray.length; i++) {
            const value = testArray[i];
            html += `<li>讀取 ${value}:`;
            
            let newIdx = 0;
            if (forest.length === 0) {
                newIdx = 1;
            } else {
                const lastHeap = forest[forest.length - 1];
                if (lastHeap.leonardoIndex === 0) {
                    newIdx = 1;
                }
            }
            
            html += ` 創建 L(${newIdx})`;
            
            // 嘗試合併
            let merged = false;
            if (forest.length >= 2) {
                const lastHeap = forest[forest.length - 1];
                const secondLastHeap = forest[forest.length - 2];
                const lastIdx = lastHeap.leonardoIndex;
                const secondLastIdx = secondLastHeap.leonardoIndex;
                
                if (secondLastIdx === lastIdx + 1) {
                    const mergedIdx = secondLastIdx + 1;
                    html += ` → 合併成 L(${mergedIdx})`;
                    
                    const mergedHeap = {
                        root: i,
                        size: LEONARDO[mergedIdx],
                        leonardoIndex: mergedIdx
                    };
                    
                    forest.pop();
                    forest.pop();
                    forest.push(mergedHeap);
                    merged = true;
                }
            }
            
            if (!merged) {
                const newHeap = {
                    root: i,
                    size: LEONARDO[newIdx],
                    leonardoIndex: newIdx
                };
                forest.push(newHeap);
            }
            
            html += `。森林現在: [${forest.map(h => `L(${h.leonardoIndex})`).join(', ')}]</li>`;
        }
        
        html += '</ol>';
        html += '<h3>最終堆森林:</h3>';
        html += '<pre>' + JSON.stringify(forest, null, 2) + '</pre>';
        
        output.innerHTML = html;
    </script>
</body>
</html>
